<div class="project-detail" *ngIf="project; else loadingTpl">
  <!-- Header -->
  <nav class="navbar">
    <div class="nav-left">
      <button class="btn-back" (click)="goBack()">â† Back</button>
      <div class="nav-brand">
        <div class="project-avatar">{{ project.name.charAt(0).toUpperCase() }}</div>
        <div>
          <h1>{{ project.name }}</h1>
          <p>{{ project.description || 'No description' }}</p>
        </div>
      </div>
    </div>
    <button class="btn-primary" (click)="openCreateTask()">+ Add Task</button>
  </nav>

  <!-- Filters -->
  <div class="filters-bar">
    <div class="filters">
      <select [(ngModel)]="filterStatus" (change)="applyFilters()">
        <option value="">All Status</option>
        <option *ngFor="let s of STATUSES" [value]="s">{{ statusLabels[s] }}</option>
      </select>

      <select [(ngModel)]="filterPriority" (change)="applyFilters()">
        <option value="">All Priority</option>
        <option *ngFor="let p of PRIORITIES" [value]="p">{{ p }}</option>
      </select>

      <button class="btn-clear" *ngIf="filterStatus || filterPriority" (click)="clearFilters()">
        âœ• Clear Filters
      </button>
    </div>
    <span class="task-count">{{ tasks.length }} task{{ tasks.length !== 1 ? 's' : '' }}</span>
  </div>

  <!-- Kanban Board -->
  <div class="kanban-board">
    <div class="kanban-column" *ngFor="let status of STATUSES">
      <div class="column-header" [class]="'col-' + status.toLowerCase()">
        <span class="col-title">{{ statusLabels[status] }}</span>
        <span class="col-count">{{ getTasksByStatus(status).length }}</span>
      </div>

      <div class="column-body">
        <div
          class="task-card"
          *ngFor="let task of getTasksByStatus(status)"
        >
          <div class="task-header">
            <span class="priority-badge" [style.background]="priorityColors[task.priority]">
              {{ task.priority }}
            </span>
            <div class="task-actions">
              <button class="btn-icon" (click)="openEditTask(task, $event)" title="Edit">âœï¸</button>
              <button class="btn-icon" (click)="deleteTask(task.id, $event)" title="Delete">ğŸ—‘ï¸</button>
            </div>
          </div>

          <h4 class="task-title">{{ task.title }}</h4>
          <p class="task-desc" *ngIf="task.description">{{ task.description }}</p>

          <div class="task-footer" *ngIf="task.dueDate">
            <span class="due-date" [class.overdue]="isOverdue(task.dueDate)">
              ğŸ“… {{ task.dueDate | date:'MMM d' }}
            </span>
          </div>
        </div>

        <div class="column-empty" *ngIf="getTasksByStatus(status).length === 0">
          <p>No tasks</p>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #loadingTpl>
  <div class="loading-screen">
    <div class="spinner-lg"></div>
    <p>Loading project...</p>
  </div>
</ng-template>

<!-- Task Modal -->
<div class="modal-overlay" *ngIf="showTaskModal" (click)="closeModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ editingTask ? 'Edit Task' : 'New Task' }}</h3>
      <button class="btn-close" (click)="closeModal()">âœ•</button>
    </div>
    <form [formGroup]="taskForm" (ngSubmit)="saveTask()">
      <div class="form-group">
        <label>Title *</label>
        <input type="text" formControlName="title" placeholder="Task title..." />
        <span class="error-text" *ngIf="taskForm.get('title')?.invalid && taskForm.get('title')?.touched">
          Title is required
        </span>
      </div>
      <div class="form-group">
        <label>Description</label>
        <textarea formControlName="description" rows="3" placeholder="Task description..."></textarea>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Status *</label>
          <select formControlName="status">
            <option *ngFor="let s of STATUSES" [value]="s">{{ statusLabels[s] }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Priority *</label>
          <select formControlName="priority">
            <option *ngFor="let p of PRIORITIES" [value]="p">{{ p }}</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label>Due Date</label>
        <input type="date" formControlName="dueDate" />
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-secondary" (click)="closeModal()">Cancel</button>
        <button type="submit" class="btn-primary" [disabled]="savingTask">
          {{ savingTask ? 'Saving...' : (editingTask ? 'Save Changes' : 'Create Task') }}
        </button>
      </div>
    </form>
  </div>
</div>
